<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Remix NoBuild Demo</title>

		<style>
			html,
			body {
				height: 100%;
			}

			body {
				margin: 0;
			}

			h1 {
				margin: 0;
			}
		</style>

		<script type="importmap">
			{
				"imports": {
					"@remix-run/dom": "https://unpkg.com/@remix-run/dom@jam/dist/index.js",
					"@remix-run/dom/jsx-runtime": "https://unpkg.com/@remix-run/dom@jam/dist/jsx-runtime.js",
					"@remix-run/dom/jsx-dev-runtime": "https://unpkg.com/@remix-run/dom@jam/dist/jsx-dev-runtime.js",
					"@remix-run/events": "https://unpkg.com/@remix-run/events@jam/dist/index.js",
					"@remix-run/style": "https://unpkg.com/@remix-run/style@jam/dist/index.js",
					"htm": "https://unpkg.com/htm?module"
				}
			}
		</script>
		<script type="module">
			import { createRoot } from "@remix-run/dom";
			import { jsx } from "@remix-run/dom/jsx-dev-runtime";
			import { createEventType, dom } from "@remix-run/events";
			import htm from "htm";

			const html = htm.bind((type, props, ...children) => {
				return jsx(type, { ...props, children }, props?.key);
			});

			// App
			function App() {
				const context = {
					theme: window.matchMedia("(prefers-color-scheme: dark)").matches
						? "dark"
						: "light",
				};
				this.context.set(context);

				let name = "World";

				return () => html`
					<form
						css=${{
							display: "flex",
							flexDirection: "column",
							justifyContent: "center",
							alignItems: "center",
							gap: "0.5rem",
							height: "100%",
						}}
					>
						<div>
							<h1>Theme</h1>

							<div
								on=${dom.change((event) => {
									context.theme = event.target.value;
									this.update();
								})}
							>
								<label>
									<input
										type="radio"
										name="theme"
										value="light"
										checked=${context.theme === "light"}
									/>
									Light
								</label>

								<label>
									<input
										type="radio"
										name="theme"
										value="dark"
										checked=${context.theme === "dark"}
									/>
									Dark
								</label>
							</div>

							<label>
								<input
									name="dark"
									type="checkbox"
									checked=${context.theme === "dark"}
									on=${dom.input((event) => {
										context.theme = event.currentTarget.checked
											? "dark"
											: "light";
										this.update();
									})}
								/>
								Dark
							</label>

							<br />
							Theme: ${context.theme}
						</div>

						<div hidden>
							<${HelloWorld}
								initialName=${name}
								on=${HelloWorld.input((event) => {
									name = event.detail;
									this.update();
								})}
							/>
							<h1>Hello again ${name}</h1>
						</div>

						<${Counter} initialCount=${3} />
					</form>
				`;
			}

			// HelloWorld
			function HelloWorld({ initialName, ...props }) {
				let name = initialName;

				return () => html`
					<div
						css=${{
							display: "flex",
							flexDirection: "column",
							alignItems: "center",
							gap: "0.5rem",
						}}
						...${props}
					>
						<input
							type="text"
							name="name"
							value=${name}
							on=${dom.input((event) => {
								name = event.currentTarget.value;
								event.currentTarget.dispatchEvent(
									createInput({ detail: name }),
								);
								this.update();
							})}
						/>
						<h1>Hello ${name}</h1>
					</div>
				`;
			}

			const [input, createInput] = createEventType("HelloWorld:input");
			HelloWorld.input = input;

			// Counter
			function Counter({ initialCount = 0 }) {
				const context = this.context.get(App);
				let count = initialCount;

				return () => html`
					<div css=${{ display: "flex", alignItems: "center", gap: "0.5rem" }}>
						<h1>Count: ${count}</h1>

						<div>
							<button
								type="button"
								css=${context.theme === "dark"
									? { background: "black", color: "white" }
									: {}}
								on=${dom.click((event) => {
									count--;
									this.update();
								})}
							>
								➖
							</button>

							<button
								type="button"
								css=${context.theme === "dark"
									? { background: "black", color: "white" }
									: {}}
								on=${dom.click((event) => {
									count++;
									this.update();
								})}
							>
								➕
							</button>
						</div>
					</div>
				`;
			}

			// Mount
			createRoot(document.body).render(html`<${App} />`);
		</script>
	</head>

	<body></body>
</html>
