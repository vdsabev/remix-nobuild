<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Remix NoBuild Demo</title>

		<style>
			html,
			body {
				height: 100%;
			}

			body {
				margin: 0;
			}

			h1 {
				margin: 0;
			}
		</style>

		<script type="importmap">
			{
				"imports": {
					"@remix-run/dom": "https://unpkg.com/@remix-run/dom@latest/dist/index.js",
					"@remix-run/dom/jsx-runtime": "https://unpkg.com/@remix-run/dom@latest/dist/jsx-runtime.js",
					"@remix-run/events": "https://unpkg.com/@remix-run/events@latest/dist/index.js",
					"@remix-run/style": "https://unpkg.com/@remix-run/style@latest/dist/index.js",
					"htm": "https://unpkg.com/htm?module"
				}
			}
		</script>
		<script type="module">
			import htm from "htm";
			import { createRoot } from "@remix-run/dom";
			import { jsx } from "@remix-run/dom/jsx-runtime";
			import { createEventType, dom } from "@remix-run/events";

			const html = htm.bind((type, props, ...children) => {
				return jsx(type, { ...props, children }, props?.key);
			});

			// App
			function App() {
				const context = {
					theme: window.matchMedia("(prefers-color-scheme: dark)").matches
						? "dark"
						: "light",
				};
				this.context.set(context);

				let name = "World";

				return () => {
					return html`
						<form
							css=${{
								display: "flex",
								flexDirection: "column",
								justifyContent: "center",
								alignItems: "center",
								gap: "0.5rem",
								height: "100%",
							}}
						>
							<div>
								<h1>Theme</h1>

								<div
									on=${dom.change((event) => {
										context.theme = event.target.value;
										this.render();
									})}
								>
									<label>
										<input
											type="radio"
											name="theme"
											value="light"
											checked=${context.theme === "light" ? "checked" : null}
										/>
										Light
									</label>

									<label>
										<input
											type="radio"
											name="theme"
											value="dark"
											checked=${context.theme === "dark" ? "checked" : null}
										/>
										Dark
									</label>
								</div>

								<label>
									<input
										type="checkbox"
										checked=${context.theme === "dark" ? "checked" : null}
										on=${dom.input((event) => {
											context.theme = event.currentTarget.checked
												? "dark"
												: "light";
											this.render();
										})}
									/>
									Dark
								</label>

								<br />
								Theme: ${context.theme}
							</div>

							<div hidden>
								<${HelloWorld}
									initialName=${name}
									on=${HelloWorld.input((event) => {
										name = event.detail;
										this.render();
									})}
								/>
								<h1>Hello again ${name}</h1>
							</div>

							<${Counter} initialCount=${3} />
						</form>
					`;
				};
			}

			// HelloWorld
			function HelloWorld({ initialName, ...props }) {
				let name = initialName;

				return () => html`
					<div
						css=${{
							display: "flex",
							flexDirection: "column",
							alignItems: "center",
							gap: "0.5rem",
						}}
						...${props}
					>
						<input
							type="text"
							name="name"
							value=${name}
							on=${dom.input((event) => {
								name = event.currentTarget.value;
								event.currentTarget.dispatchEvent(
									createInput({ detail: name }),
								);
								this.render();
							})}
						/>
						<h1>Hello ${name}</h1>
					</div>
				`;
			}

			const [input, createInput] = createEventType("HelloWorld:input");
			HelloWorld.input = input;

			// Counter
			function Counter({ initialCount = 0 }) {
				const context = this.context.get(App);
				let count = initialCount;

				return () => {
					return html`
						<div
							css=${{ display: "flex", alignItems: "center", gap: "0.5rem" }}
						>
							<h1>Count: ${count}</h1>

							<div>
								<button
									type="button"
									css=${context.theme === "dark"
										? { background: "black", color: "white" }
										: {}}
									on=${dom.click((event) => {
										count--;
										this.render();
									})}
								>
									➖
								</button>

								<button
									type="button"
									css=${context.theme === "dark"
										? { background: "black", color: "white" }
										: {}}
									on=${dom.click((event) => {
										count++;
										this.render();
									})}
								>
									➕
								</button>
							</div>
						</div>
					`;
				};
			}

			// Mount
			createRoot(document.body).render(html`<${App} />`);
		</script>
	</head>

	<body></body>
</html>
